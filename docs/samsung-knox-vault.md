# 三星 Knox 保险库的工作原理

> 原文：<https://www.xda-developers.com/samsung-knox-vault/>

三星 Knox 几乎预装在每部三星 Galaxy 智能手机上，它是设备所有者的一种安全解决方案，以确保他们的智能手机和数据安全。它利用了硬件支持的安全性和软件，扩展了 TrustZone 的功能，trust zone 是三星在其智能手机上实现的可信执行环境(TEE)。Knox Vault 在 Android 智能手机上完全独立于主处理器运行，在较新的三星旗舰智能手机上也可以使用。

Knox Vault 和 TrustZone 一样，保护您的密码、生物特征和加密密钥。不同的是，TrustZone 与 Android 同时运行一个独立的操作系统，但仍然在主应用程序处理器上，当你解锁手机时，Android 会请求 TrustZone 小程序代表你验证指纹或密码。它的设计使得即使你的 Android 安装被破坏，你的生物特征和密码也不能被泄露。Knox Vault 比这更进了一步，它是 TrustZone 的升级版替代品。

## TrustZone 和 Knox Vault，有什么区别？

TEE 是 SoC 上用于处理关键数据的安全区域。TEE 在搭载 Android 8 Oreo 及更高版本的设备上是强制性的，这意味着任何最近的智能手机都有它。任何不在 TEE 内的内容都被认为是“不可信的”,只能看到加密的内容。例如，受 DRM 保护的内容是用密钥加密的，只有在 TEE 上运行的软件才能访问这些密钥。主处理器只能看到加密内容流，而内容可以由 TEE 解密，然后显示给用户。诺克斯跳马也是一个球座。

在 Knox Vault 的案例中，三星表示它“扩展”了 TrustZone 提供的保护。根据三星的说法，Knox Vault 是 TrustZone 的替代品，该公司在一篇博客文章中以如下方式[描述了这种差异:](https://www.samsungknox.com/en/blog/understanding-samsung-knox-vault-protecting-the-data-that-matters-most)

> 在我看来，TrustZone 在您的银行分支机构中间是一个非常安全的地方。有很多你不一定信任的人在保险箱旁走过，做着不需要实际接触保险箱的日常工作。三星 Knox Vault 中的安全处理器更像是 Fort Knox:一个安全地放置在远离银行的地方的保险箱，与任何走进分行的人隔离。

## 三星的 Knox 保险库是如何工作的

Knox Vault 扩展了 TrustZone 已经提供的安全性，来自 [Galaxy S21](http://xda-developers.com/samsung-galaxy-s21/) 和更高版本的三星手机都有它。诺克斯保险库可以:

*   存储敏感数据，如硬件支持的 Android 密钥库密钥、三星证明密钥(SAK)、生物特征数据和区块链证书。
*   运行安全关键型代码，该代码通过增加故障之间的超时时间来对用户进行身份验证，并根据身份验证控制对密钥的访问。

Knox Vault 不仅仅是一个软件隔离，它还是一个与智能手机芯片组的物理隔离。它是 SoC 上的独立处理器，存储在物理上与 SoC 的其余部分分离。由于这种物理隔离，Knox Vault 甚至可以免受针对主处理器上运行的其他软件的旁路攻击。

## 诺克斯金库的建筑

诺克斯保险库由以下部分组成:

*   Knox 保险库子系统:作为 SoC 的一部分实施
*   Knox Vault 存储:物理上位于 SoC 外部的集成电路

### Knox Vault 如何保护自己免受攻击

如果有人可以接触到您的设备，您应该采取行动并做好准备，就好像他们访问存储在设备上的受保护数据只是时间问题一样。三星表示，有了 Knox Vault，情况可能就不一定如此了。它可以抵御硬件攻击，例如:

*   物理探测以披露数据
*   对电路进行物理操作以解除安全机制
*   强制信息泄露
*   硬件旁道攻击，如差分功耗分析，以泄露数据
*   绕过安全机制的故障注入。

此外，Knox Vault 处理器通过专用的 I2C(内部集成电路)总线与 Knox Vault 存储器通信。该总线上的流量是加密的，并使用认证码进行传输，以防止窃听通信，并且这些通信还可以防止重放攻击。

### 诺克斯金库子系统

Knox 保险库子系统设计为独立于其他 SoC 组件运行。它有自己的安全处理环境，包括 Knox Vault 处理器、SRAM 和 ROM。它还通过使用一系列安全传感器或检测器监控硬件状态及其环境，针对各种基于硬件的攻击提供增强的安全性和数据保护，这些传感器或检测器包括:

*   高低温探测器
*   高和低电源电压检测器
*   电源电压毛刺检测器
*   激光探测器

当 Knox Vault 处理器启动时，ROM 代码被载入 SRAM。而 ROM 代码在 SoC 主处理器上运行的模块的帮助下加载 Knox Vault 处理器固件。Knox Vault 处理器的软件堆栈有自己的安全引导链。

Knox Vault 子系统还包括一个专用的随机数生成器和自己的加密引擎。Knox Vault 处理器可以通过外部存储器管理器访问系统 DRAM。Knox Vault 处理器上的任何应用程序都不能影响或绕过这种监控，物理入侵将启动设备锁定序列。

加密引擎提供以下加密功能:

*   AES 加密/解密
*   DRBG 随机数生成
*   SHA 散列法
*   用于消息认证码的 HMAC 键控散列法
*   RSA 和 ECC 密钥生成和服务

### 诺克斯保险库

Knox Vault 存储是一种专用的非易失性存储设备，用于存储敏感数据，例如:

*   密码密钥，如区块链密钥和设备密钥
*   生物特征数据
*   哈希验证凭据

就像 Knox Vault 处理器一样，存储也可以抵御物理攻击和旁道攻击。它有一个安全内核来完成以下任务:

*   执行 ROM 代码
*   通过软件库为公钥算法(RSA、ECC)和 SHA 算法提供加密操作
*   将数据安全地存储在专用的 SRAM 和 ROM 中

## 支持 Knox Vault 的三星手机

Knox vault 由选定的三星 Galaxy 智能手机和平板电脑支持，如三星 Galaxy S21 以及后来在 S 系列和 [Fold 系列](https://www.xda-developers.com/samsung-galaxy-z-fold-4-review/)中发布的设备。提供的安全级别旨在让您对存储个人数据的智能手机充满信心，特别是对于那些可能依赖手机存储敏感数据或其他企业用途的人。